import{r as c,j as a,A as F}from"./app-CKsL3646.js";import{i as P}from"./image_map-NXhAFMho.js";import{a as S}from"./axios-jmf-bffH.js";import{s as A,a as E}from"./loadToastr-TenBaWwp.js";import{S as I}from"./Select2Input-Cp5z5cZC.js";function q({resource_name:d,editHumanResourceData:l,onClose:p}){var n,b;const[e,r]=c.useState({name:"",email:"",password:"",phone:"",address:"",avatar:""}),[t,h]=c.useState({}),[y,j]=c.useState(!1),w=c.useRef(null),o=c.useRef(null),[m,x]=c.useState(null);c.useEffect(()=>{if(!e.avatar){x(P.blank_avatar);return}if(typeof e.avatar=="string")x(e.avatar);else{const s=URL.createObjectURL(e.avatar);return x(s),()=>URL.revokeObjectURL(s)}},[e.avatar]),c.useEffect(()=>{if(!o.current)return;const s=window.$(o.current);return s.on("hidden.bs.modal",()=>{p==null||p(),h({}),r({name:"",email:"",password:"",phone:"",address:"",avatar:""})}),()=>s.off("hidden.bs.modal")},[p]),c.useEffect(()=>{if(!(l!=null&&l.data))return;const{name:s,email:f,phone:g,address:i,img_url:v}=l.data;r({name:s||"",email:f||"",password:"",phone:g||"",address:i||"",avatar:v&&`${window.location.origin}/storage/${v}`||""})},[l]);const N=async s=>{var v;const f=bootstrap.Modal.getInstance(o.current);s.preventDefault(),j(!0),s.preventDefault();let g=(v=l==null?void 0:l.data)==null?void 0:v.id;const i=new FormData;e.avatar&&e.avatar instanceof File&&i.append("avatar",e.avatar),i.append("name",e.name||""),i.append("email",e.email||""),i.append("password",e.password||""),i.append("phone",e.phone||""),i.append("address",e.address||""),g&&i.append("_method","PATCH"),g&&i.append("id",g||""),await S.post(g?route("human_resources.update",{human_resource:d}):route("human_resources.create",{human_resource:d}),i,{headers:{"Content-Type":"multipart/form-data"}}).then(u=>{u.data.status===200?(A(u.data.message),f.hide(),F.reload({only:[`${d}s`]}),h({}),r({name:"",email:"",password:"",phone:"",address:"",avatar:""}),w.current.reset()):h(u.data.errors||{}),j(!1)}).catch(u=>{var _,k;h(((k=(_=u==null?void 0:u.response)==null?void 0:_.data)==null?void 0:k.errors)||{})})};return a.jsx(a.Fragment,{children:a.jsx("div",{className:"modal fade",ref:o,id:`kt_modal_add_edit_human_resource_${d}`,tabIndex:"-1","aria-hidden":"true",children:a.jsx("div",{className:"modal-dialog modal-dialog-centered mw-650px",children:a.jsxs("div",{className:"modal-content",children:[a.jsxs("div",{className:"modal-header",id:"kt_modal_add_edit_human_header",children:[a.jsxs("h2",{className:"fw-bold",children:[" ",(n=l==null?void 0:l.data)!=null&&n.id?"Edit":"Add"," ",((b=d==null?void 0:d.charAt(0))==null?void 0:b.toUpperCase())+(d==null?void 0:d.slice(1))]}),a.jsx("div",{className:"btn btn-icon btn-sm btn-active-icon-primary","data-bs-dismiss":"modal",children:a.jsx("span",{className:"svg-icon svg-icon-1",children:a.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[a.jsx("rect",{opacity:"0.5",x:"6",y:"17.3137",width:"16",height:"2",rx:"1",transform:"rotate(-45 6 17.3137)",fill:"currentColor"}),a.jsx("rect",{x:"7.41422",y:"6",width:"16",height:"2",rx:"1",transform:"rotate(45 7.41422 6)",fill:"currentColor"})]})})})]}),a.jsx("div",{className:"modal-body scroll-y mx-5 mx-xl-15 my-7",children:a.jsxs("form",{onSubmit:N,ref:w,id:"kt_modal_add_edit_human_form",className:"form",encType:"multipart/form-data",children:[a.jsxs("div",{className:"d-flex flex-column scroll-y me-n7 pe-7",id:"kt_modal_add_edit_human_scroll","data-kt-scroll":"true","data-kt-scroll-activate":"{default: false, lg: true}","data-kt-scroll-max-height":"auto","data-kt-scroll-dependencies":"#kt_modal_add_edit_human_header","data-kt-scroll-wrappers":"#kt_modal_add_edit_human_scroll","data-kt-scroll-offset":"300px",children:[a.jsxs("div",{className:"fv-row mb-7",children:[a.jsx("label",{className:"d-block fw-semibold fs-6 mb-5",children:"Avatar"}),a.jsxs("div",{className:"image-input image-input-outline image-input-placeholder","data-kt-image-input":"true",children:[a.jsx("div",{className:"image-input-wrapper w-125px h-125px rounded border",style:{backgroundImage:`url(${m})`,backgroundSize:"contain",backgroundPosition:"center"}}),a.jsxs("label",{className:"btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-body shadow","data-kt-image-input-action":"change","data-bs-toggle":"tooltip",title:"Change avatar",children:[a.jsx("i",{className:"bi bi-pencil-fill fs-7"}),a.jsx("input",{type:"file",name:"avatar",accept:".png, .jpg, .jpeg",defaultValue:(e==null?void 0:e.avatar)||"",onChange:s=>{const f=s.target.files[0];r({...e,avatar:f})}}),a.jsx("input",{type:"hidden",name:"avatar_remove"})]}),a.jsx("span",{className:"btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-body shadow","data-kt-image-input-action":"cancel","data-bs-toggle":"tooltip",title:"Cancel avatar",onClick:()=>r({...e,avatar:""}),children:a.jsx("i",{className:"bi bi-x fs-2"})}),a.jsx("span",{className:"btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-body shadow","data-kt-image-input-action":"remove","data-bs-toggle":"tooltip",title:"Remove avatar",onClick:()=>r({...e,avatar:""}),children:a.jsx("i",{className:"bi bi-x fs-2"})})]}),a.jsx("div",{className:"form-text",children:"Allowed file types: png, jpg, jpeg."}),t.avatar&&a.jsx("div",{className:"text-danger",children:t.avatar})]}),a.jsxs("div",{className:"fv-row mb-7",children:[a.jsx("label",{className:"required fw-semibold fs-6 mb-2",children:"Full Name"}),a.jsx("input",{type:"text",name:"name",onInput:s=>r({...e,name:s.target.value}),className:"form-control form-control-solid mb-3 mb-lg-0",placeholder:"Full name",defaultValue:(e==null?void 0:e.name)||""}),t.name&&a.jsx("div",{className:"text-danger",children:t.name})]}),a.jsxs("div",{className:"fv-row mb-7",children:[a.jsx("label",{className:"required fw-semibold fs-6 mb-2",children:"Password"}),a.jsx("input",{type:"password",name:"password",onInput:s=>r({...e,password:s.target.value}),className:"form-control form-control-solid mb-3 mb-lg-0",placeholder:"Password"}),t.password&&a.jsx("div",{className:"text-danger",children:t.password})]}),a.jsxs("div",{className:"fv-row mb-7",children:[a.jsx("label",{className:"required fw-semibold fs-6 mb-2",children:"Email"}),a.jsx("input",{type:"email",name:"email",onInput:s=>r({...e,email:s.target.value}),className:"form-control form-control-solid mb-3 mb-lg-0",placeholder:"example@domain.com",defaultValue:(e==null?void 0:e.email)||""}),t.email&&a.jsx("div",{className:"text-danger",children:t.email})]}),a.jsxs("div",{className:"fv-row mb-7",children:[a.jsx("label",{className:"required fw-semibold fs-6 mb-2",children:"Phone"}),a.jsx("input",{type:"text",name:"phone",className:"form-control form-control-solid mb-3 mb-lg-0",onInput:s=>r({...e,phone:s.target.value}),placeholder:"Enter Phone",defaultValue:(e==null?void 0:e.phone)||""}),t.phone&&a.jsx("div",{className:"text-danger",children:t.phone})]}),a.jsxs("div",{className:"fv-row mb-7",children:[a.jsx("label",{className:"fs-6 mb-2",children:"Address"}),a.jsx("input",{type:"text",name:"address",onInput:s=>r({...e,address:s.target.value}),className:"form-control form-control-solid mb-3 mb-lg-0",defaultValue:(e==null?void 0:e.address)||"",placeholder:"Enter Address"}),t.address&&a.jsx("div",{className:"text-danger",children:t.address})]})]}),a.jsxs("div",{className:"text-center pt-15",children:[a.jsx("button",{type:"reset",className:"btn btn-light me-3","data-bs-dismiss":"modal",children:"Discard"}),a.jsxs("button",{disabled:y?"disabled":"",type:"submit",className:"btn btn-primary","data-kt-users-modal-action":"submit",children:[a.jsx("span",{className:"indicator-label",children:"Submit"}),a.jsxs("span",{className:"indicator-progress",children:["Please wait...",a.jsx("span",{className:"spinner-border spinner-border-sm align-middle ms-2"})]})]})]})]})})]})})})})}function M({data:d,resource:l,headings:p}){const[e,r]=c.useState(""),[t,h]=c.useState(!1),y=o=>{r(o)},j=()=>{const o=document.getElementById("kt_modal_export_users"),m=bootstrap.Modal.getInstance(o);m&&m.hide(),r(""),$("select[name='format']").val(null).trigger("change")},w=async()=>{var x,N;h(!0);const o=d.map(n=>{const b={};return p.forEach(s=>{s in n&&(b[s]=n[s])}),b}),m=new FormData;m.append("format",e),m.append("data",JSON.stringify(o)),m.append("resource",l),m.append("headings",JSON.stringify(p));try{const n=await S.post(route("export_data"),m,{responseType:"blob"});if(n.status===200){const b=window.URL.createObjectURL(new Blob([n.data])),s=document.createElement("a"),f=`${l}_export.${e==="excel"?"xlsx":e}`;s.href=b,s.setAttribute("download",f),document.body.appendChild(s),s.click(),s.remove()}else E("Export failed with status "+n.status)}catch(n){console.error(n),E(((N=(x=n==null?void 0:n.response)==null?void 0:x.data)==null?void 0:N.message)||"Something went wrong while exporting.")}finally{h(!1)}};return a.jsx(a.Fragment,{children:a.jsxs("form",{id:"kt_modal_export_users_form",className:"form",action:"#",children:[a.jsxs("div",{className:"fv-row mb-10",children:[a.jsx("label",{className:"required fs-6 fw-semibold form-label mb-2",children:"Select Export Format:"}),a.jsxs(I,{name:"format","data-control":"select2","data-placeholder":"Select a format","data-hide-search":"true",className:"form-select form-select-solid fw-bold",defaultValue:e,onChange:o=>{y(o)},children:[a.jsx("option",{}),a.jsx("option",{value:"excel",children:"Excel"}),a.jsx("option",{value:"pdf",children:"PDF"}),a.jsx("option",{value:"csv",children:"CSV"})]})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("button",{type:"reset",className:"btn btn-light me-3",onClick:j,children:"Discard"}),a.jsxs("button",{className:"btn btn-primary","data-kt-users-modal-action":"submit",disabled:!e||t,onClick:w,children:[!t&&a.jsx("span",{className:"indicator-label",children:"Export"}),t&&a.jsx("span",{className:"indicator-label",children:"Please Wait.."})]})]})]})})}export{q as A,M as D};
